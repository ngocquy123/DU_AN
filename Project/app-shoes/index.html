<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="frontend/asset/image/favicon.ico">
    <title>Sneaker Qu√Ω</title>
    <link rel="stylesheet" href="frontend/style.css">
</head>

<body>
    <section class="main">
        <div class="card">
            <div class="card__header">
                <img class="img-logo" src="frontend/asset/image/nike.png" alt="">
            </div>
            <div class="card__title">Our Product</div>
            <div class="card__body">
                <div class="product">
                    <!-- <div class="item">
                        <div class="item--image"><img
                                src="frontend/asset/image/vaporfly-4-flyknit-running-shoe-v7G3FB-removebg-preview.png"
                                alt=""></div>
                        <div class="item--name">Nike Air Zoom Pegasus 36</div>
                        <div class="item--description">The iconic Nike Air Zoom Pegasus 36 offers more cooling and mesh
                            that targets breathability across high-heat areas. A slimmer heel collar and tongue reduce
                            bulk, while exposed cables give you a snug fit at higher speeds.</div>
                        <div class="item--bottom">
                            <div class="item--bottom-price">$108.97</div>
                            <div class="item--button-cart">
                                <p>ADD TO CART</p>
                            </div>
                        </div>
                    </div>
                   -->

                </div>
            </div>
        </div>
        <div class="card">
            <div class="card__header">
                <img class="img-logo" src="frontend/asset/image/nike.png" alt="">
            </div>
            <div class="card__title">Your cart <span class="card__title--amount">$108.97</span></div>
            <div class="card__body">
                <div class="cart">
                    <!-- <div class="item">
                        <div class="item__left">
                            <div class="item__left--image">
                                <div class="item--left__imageBlock">
                                    <img src="frontend/asset/image/vaporfly-4-flyknit-running-shoe-v7G3FB-removebg-preview.png"
                                        alt="">
                                </div>
                            </div>

                        </div>
                        <div class="item__right">
                            <div class="item__right--name">Nike Air Zoom Pegasus 36</div>
                            <div class="item__right--price">$108.97</div>
                            <div class="item__right--action">
                                <div class="item--right__count">
                                    <div class="item-right--countbutton">-</div>
                                    <div class="item-right--countnumber">1</div>
                                    <div class="item-right--countbutton">+</div>
                                </div>
                                <div class="item--right__remove">
                                    <img src="frontend/asset/image/trash.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="item__left">
                            <div class="item__left--image">
                                <div class="item--left__imageBlock">
                                    <img src="frontend/asset/image/vaporfly-4-flyknit-running-shoe-v7G3FB-removebg-preview.png"
                                        alt="">
                                </div>
                            </div>

                        </div>
                        <div class="item__right">
                            <div class="item__right--name">Nike Air Zoom Pegasus 36</div>
                            <div class="item__right--price">$108.97</div>
                            <div class="item__right--action">
                                <div class="item--right__count">
                                    <div class="item-right--countbutton">-</div>
                                    <div class="item-right--countnumber">1</div>
                                    <div class="item-right--countbutton">+</div>
                                </div>
                                <div class="item--right__remove">
                                    <img src="frontend/asset/image/trash.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="item__left">
                            <div class="item__left--image">
                                <div class="item--left__imageBlock">
                                    <img src="frontend/asset/image/vaporfly-4-flyknit-running-shoe-v7G3FB-removebg-preview.png"
                                        alt="">
                                </div>
                            </div>

                        </div>
                        <div class="item__right">
                            <div class="item__right--name">Nike Air Zoom Pegasus 36</div>
                            <div class="item__right--price">$108.97</div>
                            <div class="item__right--action">
                                <div class="item--right__count">
                                    <div class="item-right--countbutton">-</div>
                                    <div class="item-right--countnumber">1</div>
                                    <div class="item-right--countbutton">+</div>
                                </div>
                                <div class="item--right__remove">
                                    <img src="frontend/asset/image/trash.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="item__left">
                            <div class="item__left--image">
                                <div class="item--left__imageBlock">
                                    <img src="frontend/asset/image/vaporfly-4-flyknit-running-shoe-v7G3FB-removebg-preview.png"
                                        alt="">
                                </div>
                            </div>

                        </div>
                        <div class="item__right">
                            <div class="item__right--name">Nike Air Zoom Pegasus 36</div>
                            <div class="item__right--price">$108.97</div>
                            <div class="item__right--action">
                                <div class="item--right__count">
                                    <div class="item-right--countbutton">-</div>
                                    <div class="item-right--countnumber">1</div>
                                    <div class="item-right--countbutton">+</div>
                                </div>
                                <div class="item--right__remove">
                                    <img src="frontend/asset/image/trash.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="item__left">
                            <div class="item__left--image">
                                <div class="item--left__imageBlock">
                                    <img src="frontend/asset/image/vaporfly-4-flyknit-running-shoe-v7G3FB-removebg-preview.png"
                                        alt="">
                                </div>
                            </div>

                        </div>
                        <div class="item__right">
                            <div class="item__right--name">Nike Air Zoom Pegasus 36</div>
                            <div class="item__right--price">$108.97</div>
                            <div class="item__right--action">
                                <div class="item--right__count">
                                    <div class="item-right--countbutton">-</div>
                                    <div class="item-right--countnumber">1</div>
                                    <div class="item-right--countbutton">+</div>
                                </div>
                                <div class="item--right__remove">
                                    <img src="frontend/asset/image/trash.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </section>

</body>
<!-- JAVASCRIPT -->
<script>

    const loadData = async () => {

        const response = await fetch('http://localhost:88/project/app-shoes/backend/getAllProduct.php', { cache: "no-cache" });
        const data = await response.json();
        let product = document.querySelector('.product');
        // console.log(data);
        let output = '';
        // console.log(data['status']);
        if (data) {
            for (let i in data) {
                output += `<div class="item" >
                        <div class="item--image" style="background-color:${data[i].color}"><img
                                src="${data[i].image}"
                                alt=""></div>
                        <div class="item--name">${data[i].name}</div>
                        <div class="item--description">${data[i].description}</div>
                        <div class="item--bottom">
                            <div class="item--bottom-price">$ ${data[i].price}</div>
                            <div class="item--button-cart" onclick="insertCart(${data[i].id})">
                                <p>ADD TO CART</p>
                            </div>
                        </div>
                    </div>`
            }
            product.innerHTML = output;
        } else {
            return false;
        }
    }
    const insertCart = async (id) => {
        const response = await fetch('http://localhost:88/project/app-shoes/backend/insertCarts.php?id=' + id,)
        const data = await response.json();
        if (data === 'success') {
            LoadCart();
            totalPrice();
            // handeButton();
        } else {
            totalPrice();
        }
    }
    const LoadCart = async () => {
        const response = await fetch('http://localhost:88/project/app-shoes/backend/getAllCart.php', { cache: "no-cache" });
        const data = await response.json();
        let cart = document.querySelector('.cart');
        let result = data.data;
        let output = '';

        if (data['status'] === 1) {
            for (let i in result) {
                output += `  <div class="item">
                        <div class="item__left">
                            <div class="item__left--image" style="background-color:${result[i].color}">
                                <div class="item--left__imageBlock" >
                                    <img src="${result[i].image}"
                                        alt="">
                                </div>
                            </div>

                        </div>
                        <div class="item__right">
                            <div class="item__right--name">${result[i].name}</div>
                            <div class="item__right--price">$ ${result[i].price}</div>
                            <div class="item__right--action">
                                <div class="item--right__count">
                                    <div class="item-right--countbutton" onclick="handleDown(${result[i].id},${result[i].quantity})">-</div>
                                    <div class="item-right--countnumber">${result[i].quantity}</div>
                                    <div class="item-right--countbutton" onclick="handleUp(${result[i].id},${result[i].quantity})">+</div>
                                </div>
                                <div class="item--right__remove" onclick="deleteItemCart(${result[i].id})">
                                    <img src="frontend/asset/image/trash.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>`
            }
            cart.innerHTML = output;
        } else {
            output = data.messenger;
            cart.innerHTML = output;
        }
    }
    const deleteItemCart = async (id) => {
        const response = await fetch("http://localhost:88/project/app-shoes/backend/deleteItemCart.php?id=" + id);
        const data = await response.json();
        if (data['status'] === 1) {
            LoadCart();
            totalPrice();
        } else {
            LoadCart();
            totalPrice();
        }
    }
    const totalPrice = async () => {
        const response = await fetch("http://localhost:88/project/app-shoes/backend/totalPriceCart.php");
        const data = await response.json();
        let totalAmount = document.querySelector('.card__title--amount');
        const result = data.data;
        let output = '', total = 0, totalSum = 0;
        if (result === 0) {
            output = '$' + result;
        } else {
            for (let i in result) {
                total += result[i].price * result[i].quantity;
            }
            output = '$' + total
        }
        totalAmount.innerHTML = output;

    }
    const handleUp = async (id, quantity) => {
        quantity;
        quantity++;
        const response = await fetch('http://localhost:88/project/app-shoes/backend/updateItemCart.php?id=' + id + '&quantity=' + quantity);
        const data = await response.json();
        totalPrice();
        LoadCart();
    }
    const handleDown = async (id, quantity) => {
        if (quantity === 1) {
            deleteItemCart(id);
            totalPrice();
            LoadCart();
        } else {
            quantity--;
            const response = await fetch('http://localhost:88/project/app-shoes/backend/updateItemCart.php?id=' + id + '&quantity=' + quantity);
            const data = await response.json();

        }
        totalPrice();
        LoadCart();
        console.log(quantity);
    }

    // Button.forEach(element => {

    // });
    // const handeButton = () => {
    //     let Button = document.querySelectorAll('.item--button-cart');
    //     Button.forEach(element => {
    //         console.log(element);
    //     });
    // }

    totalPrice();
    LoadCart();
    loadData();
</script>

</html>